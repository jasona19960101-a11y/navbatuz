<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NAVBATUZ ‚Äî Admin</title>
  <style>
    :root{
      --bg1:#070b16; --bg2:#0b1020;
      --card:rgba(255,255,255,.06);
      --b:rgba(255,255,255,.14);
      --t:#e8eeff; --muted:rgba(232,238,255,.65);
      --ok:#52ffa8; --bad:#ff6b6b; --warn:#ffd166;
      --shadow:0 14px 40px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--t);
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(82,255,168,.15), transparent 55%),
        radial-gradient(900px 500px at 90% 35%, rgba(120,130,255,.18), transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
    }
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap}
    .brand{display:flex;gap:10px;align-items:center}
    .badge{
      width:38px;height:38px;border-radius:14px;border:1px solid var(--b);
      background:rgba(255,255,255,.06);display:grid;place-items:center;box-shadow:var(--shadow)
    }
    .title{font-weight:900;letter-spacing:.6px;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin-top:2px}
    .grid{display:grid;grid-template-columns:1.35fr .65fr;gap:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--b);border-radius:var(--r);padding:14px;box-shadow:var(--shadow)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    input,select{
      background:rgba(255,255,255,.06);color:var(--t);
      border:1px solid var(--b);border-radius:12px;padding:10px 12px;outline:none;
    }
    input::placeholder{color:rgba(232,238,255,.45)}
    input.mid{min-width:240px}
    input.wide{min-width:320px}

    button{
      border:1px solid var(--b);
      background:rgba(255,255,255,.08);
      color:var(--t);
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      user-select:none;
    }
    button:hover{background:rgba(255,255,255,.12)}
    button.primary{border-color:rgba(82,255,168,.35);background:rgba(82,255,168,.12)}
    button.danger{border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.12)}
    button.warn{border-color:rgba(255,209,102,.35);background:rgba(255,209,102,.12)}
    button:disabled{opacity:.55;cursor:not-allowed}

    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    @media (max-width:760px){.kpis{grid-template-columns:repeat(2,1fr)}}
    .kpi{
      padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05)
    }
    .kpi .l{font-size:12px;color:var(--muted)}
    .kpi .v{font-size:20px;font-weight:900;margin-top:2px}

    .msg{margin-top:10px;font-size:13px;color:var(--muted)}
    .msg .ok{color:var(--ok)}
    .msg .bad{color:var(--bad)}
    .msg .warn{color:var(--warn)}

    table{width:100%;border-collapse:collapse;margin-top:10px;overflow:hidden;border-radius:14px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);font-size:13px;vertical-align:middle}
    th{color:rgba(232,238,255,.75);text-align:left;font-weight:800}
    tr:hover td{background:rgba(255,255,255,.03)}
    .pill{
      display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);font-size:12px
    }
    .pill.ok{border-color:rgba(82,255,168,.35);background:rgba(82,255,168,.10)}
    .pill.warn{border-color:rgba(255,209,102,.35);background:rgba(255,209,102,.10)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}
    .small{font-size:12px;color:rgba(232,238,255,.6)}
    .divider{height:1px;background:rgba(255,255,255,.12);margin:12px 0}
    .btnMini{padding:7px 10px;border-radius:10px;font-size:12px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}

    /* Searchable org dropdown */
    .dropWrap{position:relative;min-width:260px;flex:1}
    .dropList{
      position:absolute; left:0; right:0; top:44px;
      background:rgba(10,16,32,.95);
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      box-shadow:0 20px 50px rgba(0,0,0,.45);
      max-height:280px;
      overflow:auto;
      z-index:999;
      display:none;
    }
    .dropItem{
      padding:10px 12px;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:13px;
      color:rgba(232,238,255,.9);
    }
    .dropItem:hover{background:rgba(255,255,255,.06)}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="top">
      <div class="brand">
        <div class="badge">üõ†Ô∏è</div>
        <div>
          <div class="title">NAVBATUZ ‚Äî Admin Panel</div>
          <div class="sub">Viloyat ‚Üí Tuman ‚Üí Muassasa ‚Ä¢ Aktiv navbat ‚Ä¢ Next / Delete / Skip</div>
        </div>
      </div>

      <div class="row">
        <button class="primary" id="btnRefresh" onclick="loadQueue()">üîÑ Yangilash</button>
        <button id="btnAuto" onclick="toggleAuto()">‚è± Auto: OFF</button>
      </div>
    </div>

    <div class="grid">

      <!-- LEFT -->
      <div class="card">

        <div class="row">
          <select id="selRegion" onchange="onRegionChange()">
            <option value="">Viloyat tanlang...</option>
          </select>

          <select id="selDistrict" onchange="onDistrictChange()">
            <option value="">Tuman tanlang...</option>
          </select>

          <!-- MUASSASA: searchable -->
          <div class="dropWrap">
            <input id="orgSearch" placeholder="Muassasa qidiring / tanlang..." oninput="filterOrgList()" onclick="openOrgList()" />
            <div id="orgList" class="dropList"></div>
          </div>

          <!-- hidden real orgId -->
          <input id="orgIdHidden" type="hidden" />

          <input id="adminKey" class="wide" placeholder="ADMIN_KEY (Render env dagi)" />
        </div>

        <div class="row" style="margin-top:10px">
          <input id="search" class="mid" placeholder="Search: ism / #raqam / status" oninput="renderTable()" />
          <select id="statusFilter" onchange="renderTable()">
            <option value="all">Status: hammasi</option>
            <option value="waiting">waiting</option>
            <option value="missed">missed</option>
          </select>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="l">Now serving</div><div class="v" id="kNow">‚Äî</div></div>
          <div class="kpi"><div class="l">Last number</div><div class="v" id="kLast">‚Äî</div></div>
          <div class="kpi"><div class="l">Avg service</div><div class="v" id="kAvg">‚Äî</div></div>
          <div class="kpi"><div class="l">Aktiv navbat</div><div class="v" id="kCnt">‚Äî</div></div>
        </div>

        <div id="msg" class="msg"></div>

        <!-- NEXT faqat muassasa tanlangandan keyin -->
        <div class="toolbar" id="orgToolbar" style="display:none">
          <button class="primary" onclick="nextOne()">‚û°Ô∏è NEXT (navbatni chaqirish)</button>
          <span class="small">* Xizmat tugagach bosib, keyingi navbatchini chaqirasiz</span>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width:80px">#</th>
              <th>Ism familiya</th>
              <th style="width:120px">ETA</th>
              <th style="width:190px">Ticket olgan</th>
              <th style="width:110px">Status</th>
              <th style="width:230px">Amallar</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>

        <div class="small" style="margin-top:10px">
          * ETA = (qolgan navbat soni) √ó avgServiceSec. Agar avg topilmasa ‚Äú‚Äî‚Äù.
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div style="font-weight:900">Tez amallar</div>
        <div class="small">Tanlangan muassasa bo‚Äòyicha.</div>

        <div class="divider"></div>

        <div class="row">
          <button class="warn" onclick="deleteAll()">üßπ Delete ALL</button>
          <button class="danger" onclick="resetOrg()">üí£ RESET</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <label class="small">Auto refresh:</label>
          <select id="autoEvery" onchange="applyAutoInterval()">
            <option value="0">OFF</option>
            <option value="3">3s</option>
            <option value="5">5s</option>
            <option value="10" selected>10s</option>
            <option value="20">20s</option>
            <option value="30">30s</option>
          </select>
          <button onclick="applyAutoInterval()">‚úÖ Apply</button>
        </div>

        <div class="divider"></div>

        <div class="small">
          Admin URL: <span class="mono">/admin.html</span>
        </div>
      </div>

    </div>
  </div>

<script>
  let GEO = null;

  // normalized
  let REGIONS = [];
  let DISTRICTS = [];
  let ORGS_BY_UNIT = {}; // orgsByUnitId

  let ORG_LIST = []; // current district orgs (array)
  let lastData = null;

  let autoTimer = null;
  let autoOn = false;

  function $(id){ return document.getElementById(id); }
  function esc(s){ return (s||"").toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
  function key(){ return ($("adminKey").value || "").trim(); }

  function setMsg(type, text){
    const cls = type === "ok" ? "ok" : (type === "warn" ? "warn" : "bad");
    $("msg").innerHTML = `<span class="${cls}">${type.toUpperCase()}:</span> ${esc(text)}`;
  }

  async function api(url, opts={}){
    const headers = Object.assign({}, opts.headers || {}, {
      "Content-Type": "application/json",
      "X-Admin-Key": key()
    });
    const res = await fetch(url, Object.assign({}, opts, { headers }));
    const data = await res.json().catch(()=>({ ok:false, error:"JSON parse error" }));
    if (!res.ok) throw new Error(data?.error || ("HTTP " + res.status));
    return data;
  }

  // --------------------------
  // GEO detect / normalize
  // --------------------------
  function isObj(x){ return x && typeof x === "object" && !Array.isArray(x); }

  function hasAnyName(o){
    return !!(o && (o.name_uz || o.nameUz || o.name || o.title || o.label));
  }

  // recursive find first array of objects that contain id and name-ish
  function findArrayByHeuristic(root, mode){
    const seen = new Set();
    function walk(node){
      if (!node || typeof node !== "object") return null;
      if (seen.has(node)) return null;
      seen.add(node);

      if (Array.isArray(node) && node.length){
        const sample = node[0];
        if (isObj(sample) && ("id" in sample)){
          if (mode === "regions"){
            if (hasAnyName(sample) && !("region_id" in sample) && !("regionId" in sample)) return node;
          }
          if (mode === "districts"){
            if (("region_id" in sample) || ("regionId" in sample) || ("parent_id" in sample) || ("parentId" in sample)) return node;
          }
        }
      }

      if (Array.isArray(node)){
        for (const it of node){
          const found = walk(it);
          if (found) return found;
        }
      } else {
        for (const k of Object.keys(node)){
          const found = walk(node[k]);
          if (found) return found;
        }
      }
      return null;
    }
    return walk(root);
  }

  function normalizeGeo(geo){
    // 1) regions
    REGIONS = geo.regions || geo.viloyatlar || geo.region || [];
    if (!Array.isArray(REGIONS) || !REGIONS.length){
      REGIONS = findArrayByHeuristic(geo, "regions") || [];
    }

    // 2) districts/units
    DISTRICTS = geo.districts || geo.tumanlar || geo.units || geo.district || [];
    if (!Array.isArray(DISTRICTS) || !DISTRICTS.length){
      DISTRICTS = findArrayByHeuristic(geo, "districts") || [];
    }

    // 3) org mapping
    ORGS_BY_UNIT = geo.orgsByUnitId || geo.orgsByUnitUZ || {};
    if (!isObj(ORGS_BY_UNIT) || !Object.keys(ORGS_BY_UNIT).length){
      // fallback (senda oldin ham bor edi)
      ORGS_BY_UNIT = {};
      const m = geo.orgsByUnitUzKey || {};
      if (isObj(m)){
        // try to transform: key contains unitId -> set ORGS_BY_UNIT[unitId]=...
        // (best effort)
        for (const k of Object.keys(m)){
          const list = m[k] || [];
          // extract number-like id from key, last digits
          const mm = String(k).match(/(\d+)\D*$/);
          const unitId = mm ? mm[1] : k;
          ORGS_BY_UNIT[String(unitId)] = list;
        }
      }
    }
  }

  function nameOf(o){
    return o?.name_uz || o?.nameUz || o?.name || o?.title || o?.label || String(o?.id ?? "");
  }
  function districtRegionId(d){
    return d.region_id ?? d.regionId ?? d.parent_id ?? d.parentId ?? d.region ?? null;
  }

  // --------------------------
  // Select fill
  // --------------------------
  function fillRegions(){
    const sel = $("selRegion");
    sel.innerHTML = `<option value="">Viloyat tanlang...</option>`;
    for (const r of REGIONS){
      sel.innerHTML += `<option value="${esc(r.id)}">${esc(nameOf(r))}</option>`;
    }
    $("selDistrict").innerHTML = `<option value="">Tuman tanlang...</option>`;
    resetOrgPicker();
  }

  function onRegionChange(){
    const rid = ($("selRegion").value || "").trim();
    $("selDistrict").innerHTML = `<option value="">Tuman tanlang...</option>`;
    resetOrgPicker();
    clearTable();

    if (!rid) return;

    const list = DISTRICTS.filter(d => String(districtRegionId(d)) === String(rid));
    for (const d of list){
      $("selDistrict").innerHTML += `<option value="${esc(d.id)}">${esc(nameOf(d))}</option>`;
    }
  }

  function onDistrictChange(){
    const did = ($("selDistrict").value || "").trim();
    resetOrgPicker();
    clearTable();
    if (!did) return;

    ORG_LIST = (ORGS_BY_UNIT[String(did)] || []).slice();
    if (!ORG_LIST.length){
      setMsg("warn", "Bu tuman uchun muassasalar topilmadi (geo.json mapping tekshir).");
      return;
    }

    // show searchable dropdown list
    renderOrgList(ORG_LIST);
    setMsg("ok", `Muassasa tanlang (topildi: ${ORG_LIST.length} ta)`);
  }

  // --------------------------
  // Searchable org dropdown
  // --------------------------
  function resetOrgPicker(){
    ORG_LIST = [];
    $("orgSearch").value = "";
    $("orgIdHidden").value = "";
    $("orgList").style.display = "none";
    $("orgToolbar").style.display = "none";
  }

  function openOrgList(){
    if (!ORG_LIST.length) return;
    $("orgList").style.display = "block";
  }

  function closeOrgList(){
    $("orgList").style.display = "none";
  }

  function renderOrgList(list){
    const box = $("orgList");
    box.innerHTML = "";
    // top 200 for UI performance (search with filter anyway)
    const show = list.slice(0, 500);
    for (const o of show){
      const item = document.createElement("div");
      item.className = "dropItem";
      item.textContent = nameOf(o);
      item.onclick = () => selectOrg(o);
      box.appendChild(item);
    }
    box.style.display = "block";
  }

  function filterOrgList(){
    const q = ($("orgSearch").value || "").trim().toLowerCase();
    if (!ORG_LIST.length) return;

    const filtered = !q
      ? ORG_LIST
      : ORG_LIST.filter(o => nameOf(o).toLowerCase().includes(q));

    renderOrgList(filtered);
  }

  function selectOrg(o){
    $("orgSearch").value = nameOf(o);
    $("orgIdHidden").value = String(o.id);
    closeOrgList();
    $("orgToolbar").style.display = "flex";
    loadQueue();
  }

  // close dropdown when clicking outside
  document.addEventListener("click", (e) => {
    const wrap = e.target.closest(".dropWrap");
    if (!wrap) closeOrgList();
  });

  function selectedOrgId(){
    return ($("orgIdHidden").value || "").trim();
  }

  // --------------------------
  // Queue table
  // --------------------------
  function clearTable(){
    $("tbody").innerHTML = `<tr><td colspan="6" class="small">Muassasa tanlang...</td></tr>`;
    $("kNow").textContent="‚Äî"; $("kLast").textContent="‚Äî"; $("kAvg").textContent="‚Äî"; $("kCnt").textContent="‚Äî";
    lastData = null;
  }

  function updateKPIs(data){
    $("kNow").textContent  = data?.nowServing ?? "‚Äî";
    $("kLast").textContent = data?.lastNumber ?? "‚Äî";
    $("kAvg").textContent  = (data?.avgServiceSec ? (Math.round(data.avgServiceSec/60) + " min") : "‚Äî");
    $("kCnt").textContent  = (data?.tickets?.length ?? 0);
  }

  function statusPill(s){
    if (s === "waiting") return `<span class="pill ok">waiting</span>`;
    if (s === "missed") return `<span class="pill warn">missed</span>`;
    return `<span class="pill">${esc(s)}</span>`;
  }

  function etaText(t, nowServing, avgServiceSec){
    const num = Number(t.number || 0);
    if (!avgServiceSec) return "‚Äî";
    const remaining = Math.max(0, num - Number(nowServing || 0));
    const minutes = Math.max(0, Math.round((remaining * avgServiceSec) / 60));
    return minutes + " min";
  }

  function createdText(t){
    try{ return t.createdAt ? new Date(t.createdAt).toLocaleString() : ""; }
    catch{ return t.createdAt || ""; }
  }

  function renderTable(){
    const tb = $("tbody");
    const q = ($("search").value || "").trim().toLowerCase();
    const sf = $("statusFilter").value;

    const nowServing = lastData?.nowServing ?? 0;
    const avg = lastData?.avgServiceSec ?? null;

    const list = (lastData?.tickets || []).filter(t => {
      if (sf !== "all" && (t.status !== sf)) return false;
      if (!q) return true;
      const num = (t.number ?? "").toString();
      const name = (t.fullName || "").toLowerCase();
      const st = (t.status || "").toLowerCase();
      return num.includes(q.replace("#","")) || name.includes(q) || st.includes(q);
    });

    if (!list.length){
      tb.innerHTML = `<tr><td colspan="6" class="small">Aktiv navbat topilmadi.</td></tr>`;
      return;
    }

    tb.innerHTML = list.map(t => {
      const eta = etaText(t, nowServing, avg);
      const ct = createdText(t);
      return `
        <tr>
          <td><span class="pill">#${esc(t.number)}</span></td>
          <td>${esc(t.fullName || "")}</td>
          <td><b>${esc(eta)}</b></td>
          <td class="small">${esc(ct)}</td>
          <td>${statusPill(t.status)}</td>
          <td>
            <button class="btnMini danger" onclick="deleteTicket('${esc(t.id)}')">Delete</button>
            <button class="btnMini warn" onclick="skipTicket('${esc(t.id)}')">Skip</button>
          </td>
        </tr>
      `;
    }).join("");
  }

  async function loadQueue(){
    const orgId = selectedOrgId();
    if (!orgId) return setMsg("warn","Muassasa tanlang");
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");

    $("btnRefresh").disabled = true;
    try{
      const data = await api(`/api/admin/queue?orgId=${encodeURIComponent(orgId)}`, { method:"GET" });
      lastData = data;
      updateKPIs(data);
      renderTable();
      setMsg("ok", `Yangilandi. Aktiv navbat: ${(data.tickets||[]).length}`);
    }catch(e){
      setMsg("bad", e.message);
    }finally{
      $("btnRefresh").disabled = false;
    }
  }

  // Actions
  async function nextOne(){
    const orgId = selectedOrgId();
    if (!orgId) return setMsg("warn","Muassasa tanlang");
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");
    if (!confirm("NEXT qilamizmi? (navbat oldinga suriladi)")) return;

    try{
      await api(`/api/admin/next`, { method:"POST", body: JSON.stringify({ orgId }) });
      setMsg("ok","NEXT OK");
      await loadQueue();
    }catch(e){
      setMsg("bad", e.message);
    }
  }

  async function deleteTicket(ticketId){
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");
    if (!confirm("Ticket CANCEL (delete) qilinsinmi?")) return;

    try{
      await api(`/api/admin/delete`, { method:"POST", body: JSON.stringify({ ticketId }) });
      setMsg("ok","Delete OK");
      await loadQueue();
    }catch(e){
      setMsg("bad", e.message);
    }
  }

  async function skipTicket(ticketId){
    const orgId = selectedOrgId();
    if (!orgId) return setMsg("warn","Muassasa tanlang");
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");
    if (!confirm("O‚Äòtkazib yuboramizmi? (missed)")) return;

    try{
      await api(`/api/admin/skip`, { method:"POST", body: JSON.stringify({ orgId, ticketId }) });
      setMsg("ok","Skip OK");
      await loadQueue();
    }catch(e){
      setMsg("bad", e.message);
    }
  }

  async function deleteAll(){
    const orgId = selectedOrgId();
    if (!orgId) return setMsg("warn","Muassasa tanlang");
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");
    if (!confirm("HAMMASI (waiting/missed) CANCEL bo‚Äòlsinmi?")) return;

    try{
      const r = await api(`/api/admin/deleteAll`, { method:"POST", body: JSON.stringify({ orgId }) });
      setMsg("ok", `DeleteAll OK. cancelledCount: ${r.cancelledCount ?? 0}`);
      await loadQueue();
    }catch(e){
      setMsg("bad", e.message);
    }
  }

  async function resetOrg(){
    const orgId = selectedOrgId();
    if (!orgId) return setMsg("warn","Muassasa tanlang");
    if (!key()) return setMsg("bad","ADMIN_KEY kiriting");
    if (!confirm("RESET xavfli: current=0 next=1 va waiting/missed CANCEL. Davom etamizmi?")) return;

    try{
      await api(`/api/admin/reset`, { method:"POST", body: JSON.stringify({ orgId }) });
      setMsg("warn","RESET OK");
      await loadQueue();
    }catch(e){
      setMsg("bad", e.message);
    }
  }

  // Auto refresh
  function toggleAuto(){
    autoOn = !autoOn;
    if (autoOn) applyAutoInterval(true);
    else stopAuto();
  }
  function stopAuto(){
    if (autoTimer) clearInterval(autoTimer);
    autoTimer = null;
    autoOn = false;
    $("btnAuto").textContent = "‚è± Auto: OFF";
  }
  function applyAutoInterval(forceOn=false){
    const sec = Number(($("autoEvery").value || 0));
    if (!sec || sec <= 0) { stopAuto(); return; }
    if (forceOn) autoOn = true;
    if (!autoOn) autoOn = true;

    if (autoTimer) clearInterval(autoTimer);
    autoTimer = setInterval(() => loadQueue(), sec * 1000);
    $("btnAuto").textContent = `‚è± Auto: ON (${sec}s)`;
    loadQueue();
  }

  // boot
  async function init(){
    try{
      const r = await fetch("/api/geo");
      GEO = await r.json();
      normalizeGeo(GEO);

      // if still empty, show debug
      if (!REGIONS.length){
        setMsg("bad", "geo.json‚Äôdan viloyatlar topilmadi. geo.json structure nomlarini moslab berish kerak.");
      } else {
        setMsg("warn", "Viloyat ‚Üí Tuman tanlang, keyin muassasa qidirib tanlang. ADMIN_KEY kiriting.");
      }

      fillRegions();
      clearTable();
    }catch(e){
      setMsg("bad","/api/geo yuklanmadi: " + e.message);
      clearTable();
    }
  }

  init();
</script>
</body>
</html>

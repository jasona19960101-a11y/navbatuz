<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NAVBATUZ</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial; background:#0b1220; color:#e8eefc; margin:0;}
    .wrap{max-width:720px; margin:0 auto; padding:28px;}
    .card{background:#121a2b; border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px;}
    .brand{font-size:28px; font-weight:800; letter-spacing:0.5px;}
    .muted{opacity:.8; line-height:1.5}
    .welcome{min-height:84px; margin-top:12px; font-size:18px; line-height:1.45;}
    .langs{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}
    button{cursor:pointer; border:1px solid rgba(255,255,255,.12); background:#1a2540; color:#e8eefc;
      padding:10px 12px; border-radius:12px; font-size:16px;}
    button:hover{filter:brightness(1.1)}
    .small{font-size:13px; opacity:.8; margin-top:12px;}
    .hidden{display:none;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">NAVBATUZ</div>
      <div class="muted">Queue management system</div>

      <div id="welcome" class="welcome"></div>

      <div id="langBlock" class="langs hidden">
        <button onclick="chooseLang('uz')">üá∫üáø O‚Äòzbek</button>
        <button onclick="chooseLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button onclick="chooseLang('en')">üá¨üáß English</button>
      </div>

      <div id="afterChoose" class="small hidden"></div>
    </div>
  </div>

  <script>
    const TEXT = {
      uz: {
        welcome: "NAVBATUZga xush kelibsiz!<br/>NAVBATUZ bilan siz vaqtingizni tejaysiz.",
        chosen: "‚úÖ Til tanlandi: O‚Äòzbek. (Keyingi bosqich: Viloyat ‚Üí Tuman ‚Üí Xizmat ...)"
      },
      ru: {
        welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NAVBATUZ!<br/>–° NAVBATUZ –≤—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ –≤—Ä–µ–º—è.",
        chosen: "‚úÖ –Ø–∑—ã–∫ –≤—ã–±—Ä–∞–Ω: –†—É—Å—Å–∫–∏–π. (–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –†–µ–≥–∏–æ–Ω ‚Üí –†–∞–π–æ–Ω ‚Üí –£—Å–ª—É–≥–∞ ...)"
      },
      en: {
        welcome: "Welcome to NAVBATUZ!<br/>With NAVBATUZ you save time.",
        chosen: "‚úÖ Language selected: English. (Next: Region ‚Üí District ‚Üí Service ...)"
      }
    };

    function getWebSession() {
      let id = localStorage.getItem("web_session");
      if (!id) {
        id = "ws_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
        localStorage.setItem("web_session", id);
      }
      return id;
    }

    const welcomeEl = document.getElementById("welcome");
    const langBlock = document.getElementById("langBlock");
    const afterChoose = document.getElementById("afterChoose");

    async function runIntro() {
      const seq = ["uz", "ru", "en"];
      for (const lang of seq) {
        welcomeEl.innerHTML = TEXT[lang].welcome;
        await new Promise(r => setTimeout(r, 3500));
      }
      langBlock.classList.remove("hidden");
      welcomeEl.innerHTML = "Tilni tanlang / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Choose a language";
    }

    async function chooseLang(lang) {
      localStorage.setItem("lang", lang);
      langBlock.classList.add("hidden");
      welcomeEl.innerHTML = TEXT[lang].welcome;
      afterChoose.classList.remove("hidden");
      afterChoose.textContent = TEXT[lang].chosen;

      try {
        await fetch("/api/lang", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ web_session: getWebSession(), lang })
        });
      } catch (e) {}
    }

    const saved = localStorage.getItem("lang");
    if (saved && TEXT[saved]) {
      chooseLang(saved);
    } else {
      runIntro();
    }
  </script>
</body>
</html>
